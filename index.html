<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Escape del Laberinto - 20 Niveles</title>
  <style>
    body {
      background: #111;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
    }
    h1 { margin: 10px; color: yellow; }
    canvas {
      background: #222;
      display: block;
      margin: auto;
      border: 3px solid white;
      max-width: 95vw;
    }
    .controls {
      margin-top: 25px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }
    .controls-row {
      display: flex;
      gap: 30px;
    }
    .controls button {
      width: 120px;
      height: 120px;
      font-size: 45px;
      border-radius: 50%;
      border: none;
      background: #444;
      color: white;
      box-shadow: 0px 6px 12px rgba(0,0,0,0.6);
      transition: transform 0.1s, background 0.2s;
    }
    .controls button:active {
      background: #888;
      transform: scale(0.9);
    }
    #ranking {
      margin-top: 20px;
      padding: 10px;
      border: 2px solid yellow;
      display: inline-block;
      font-size: 18px;
    }
    #mensaje {
      margin-top: 15px;
      padding: 10px;
      font-size: 20px;
      font-weight: bold;
      color: cyan;
    }
  </style>
</head>
<body>
  <h1>‚ö° Escape del Laberinto - 20 Niveles</h1>
  <h2 id="nivel">Nivel: 1</h2>
  <h3 id="vidas">Vidas: 3</h3>
  <canvas id="gameCanvas" width="900" height="600"></canvas>

  <div class="controls">
    <div><button id="btnUp">‚¨ÜÔ∏è</button></div>
    <div class="controls-row">
      <button id="btnLeft">‚¨ÖÔ∏è</button>
      <button id="btnDown">‚¨áÔ∏è</button>
      <button id="btnRight">‚û°Ô∏è</button>
    </div>
  </div>

  <div id="ranking">
    <h3>üèÜ Ranking de Tiempos</h3>
    <p id="tiempoActual">Tiempo actual: 0s</p>
    <p id="mejorTiempo">Mejor tiempo: -</p>
  </div>

  <div id="mensaje"></div>

  <!-- üéµ sonidos -->
  <audio id="sndMuerte" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
  <audio id="sndReinicio" src="https://actions.google.com/sounds/v1/cartoon/concussive_drum_hit.ogg"></audio>
  <audio id="sndVictoria" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const sndMuerte = document.getElementById("sndMuerte");
    const sndReinicio = document.getElementById("sndReinicio");
    const sndVictoria = document.getElementById("sndVictoria");

    const player = { x: 20, y: 20, size: 25, color: "cyan", speed: 4 };
    const goal = { x: 850, y: 550, size: 35, color: "red" };

    let level = 1;
    let lives = 3;
    let keys = { ArrowUp: false, ArrowDown: false, ArrowLeft: false, ArrowRight: false };
    let walls = [];
    let enemies = [];
    let base = { x: 10, y: 10, w: 120, h: 120, color: "green" };

    // üïí tiempo
    let startTime = Date.now();
    let tiempoActual = 0;
    let mejorTiempo = localStorage.getItem("mejorTiempo") || null;

    function actualizarTiempo() {
      tiempoActual = Math.floor((Date.now() - startTime) / 1000);
      document.getElementById("tiempoActual").textContent = "Tiempo actual: " + tiempoActual + "s";
      if (mejorTiempo) {
        document.getElementById("mejorTiempo").textContent = "Mejor tiempo: " + mejorTiempo + "s";
      }
    }
    setInterval(actualizarTiempo, 1000);

    const levels = [];
    for (let i = 1; i <= 20; i++) {
      let walls = [];
      let enemies = [];
      // üîπ columnas m√°s peque√±as
      for (let j = 0; j < i + 2; j++) {
        walls.push({ x: 150 + Math.random() * 700 | 0, y: 100 + Math.random() * 400 | 0, w: 30, h: 80 });
      }
      // üîπ enemigos
      for (let k = 0; k < i; k++) {
        enemies.push({
          x: 200 + Math.random() * 600 | 0,
          y: 150 + Math.random() * 350 | 0,
          w: 25, h: 25,
          dx: (Math.random() < 0.5 ? 1 : -1) * (2 + i/5),
          dy: (Math.random() < 0.5 ? 1 : -1) * (2 + i/5)
        });
      }
      levels.push({ walls, enemies });
    }

    function loadLevel(lv) {
      document.getElementById("nivel").textContent = "Nivel: " + lv;
      document.getElementById("vidas").textContent = "Vidas: " + lives;
      walls = levels[lv-1].walls;
      enemies = levels[lv-1].enemies.map(e => ({...e}));
      player.x = base.x + 20;
      player.y = base.y + 20;
    }

    function drawRect(obj, color) {
      ctx.fillStyle = color;
      ctx.fillRect(obj.x, obj.y, obj.w || obj.size, obj.h || obj.size);
    }

    function checkCollision(a, b) {
      return a.x < b.x + (b.w || b.size) &&
             a.x + (a.w || a.size) > b.x &&
             a.y < b.y + (b.h || b.size) &&
             a.y + (a.h || a.size) > b.y;
    }

    function resetKeys() { for (let k in keys) keys[k] = false; }

    function resetGame() {
      level = 1; lives = 3; resetKeys();
      loadLevel(level);
      startTime = Date.now();
      showMessage("üîÑ Juego reiniciado", "cyan");
      sndReinicio.play();
    }

    function showMessage(txt, color="yellow") {
      let box = document.getElementById("mensaje");
      box.textContent = txt;
      box.style.color = color;
      setTimeout(()=> box.textContent = "", 3000);
    }

    function update() {
      if (keys.ArrowUp) player.y -= player.speed;
      if (keys.ArrowDown) player.y += player.speed;
      if (keys.ArrowLeft) player.x -= player.speed;
      if (keys.ArrowRight) player.x += player.speed;

      if (player.x < 0) player.x = 0;
      if (player.y < 0) player.y = 0;
      if (player.x + player.size > canvas.width) player.x = canvas.width - player.size;
      if (player.y + player.size > canvas.height) player.y = canvas.height - player.size;

      for (let w of walls) {
        if (checkCollision(player, w)) {
          if (keys.ArrowUp) player.y += player.speed;
          if (keys.ArrowDown) player.y -= player.speed;
          if (keys.ArrowLeft) player.x += player.speed;
          if (keys.ArrowRight) player.x -= player.speed;
        }
      }

      for (let e of enemies) {
        e.x += e.dx; e.y += e.dy;
        if (e.x <= 0 || e.x + e.w >= canvas.width) e.dx *= -1;
        if (e.y <= 0 || e.y + e.h >= canvas.height) e.dy *= -1;

        // üö´ impedir que los enemigos entren a la base
        if (checkCollision(e, base)) {
          if (e.x < base.x || e.x + e.w > base.x + base.w) e.dx *= -1;
          if (e.y < base.y || e.y + e.h > base.y + base.h) e.dy *= -1;
          e.x += e.dx * 2;
          e.y += e.dy * 2;
        }

        // ‚ö†Ô∏è colisi√≥n mortal solo fuera de la base
        if (checkCollision(player, e) && !checkCollision(player, base)) {
          lives--;
          if (lives > 0) {
            showMessage("üíÄ Moriste! Vidas: " + lives, "red");
            sndMuerte.play();
            resetKeys();
            loadLevel(level);
          } else {
            showMessage("‚ò†Ô∏è Sin vidas, reiniciando...", "red");
            sndMuerte.play();
            setTimeout(resetGame, 1500);
          }
          return;
        }
      }

      if (checkCollision(player, goal)) {
        if (level < levels.length) {
          level++;
          showMessage("‚úÖ Nivel " + level + " alcanzado", "lime");
          sndVictoria.play();
          loadLevel(level);
        } else {
          let tiempoTotal = Math.floor((Date.now() - startTime) / 1000);
          showMessage("üèÜ ¬°Ganaste en " + tiempoTotal + "s!", "gold");
          sndVictoria.play();
          if (!mejorTiempo || tiempoTotal < mejorTiempo) {
            mejorTiempo = tiempoTotal;
            localStorage.setItem("mejorTiempo", mejorTiempo);
          }
          setTimeout(resetGame, 3000);
        }
      }
    }

    function draw() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      drawRect(base, base.color);
      drawRect(goal, goal.color);
      drawRect(player, player.color);
      for (let w of walls) drawRect(w, "gray");
      for (let e of enemies) drawRect(e, "yellow");
    }

    function gameLoop() { update(); draw(); requestAnimationFrame(gameLoop); }

    document.addEventListener("keydown", e => { if (keys.hasOwnProperty(e.key)) keys[e.key] = true; });
    document.addEventListener("keyup", e => { if (keys.hasOwnProperty(e.key)) keys[e.key] = false; });

    function addControl(id, key) {
      const btn = document.getElementById(id);
      btn.addEventListener("touchstart", e => { e.preventDefault(); keys[key] = true; });
      btn.addEventListener("touchend", e => { e.preventDefault(); keys[key] = false; });
      btn.addEventListener("mousedown", e => { e.preventDefault(); keys[key] = true; });
      btn.addEventListener("mouseup", e => { e.preventDefault(); keys[key] = false; });
      btn.addEventListener("mouseleave", e => { e.preventDefault(); keys[key] = false; });
    }
    addControl("btnUp","ArrowUp");
    addControl("btnDown","ArrowDown");
    addControl("btnLeft","ArrowLeft");
    addControl("btnRight","ArrowRight");

    loadLevel(level);
    gameLoop();
  </script>
</body>
</html>




