<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Escape del Laberinto - 20 Niveles</title>
  <style>
    body {
      background: #111;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
    }
    h1 {
      margin: 10px;
      color: yellow;
    }
    canvas {
      background: #222;
      display: block;
      margin: auto;
      border: 3px solid white;
      max-width: 95vw;
    }
    .controls {
      margin-top: 25px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }
    .controls-row {
      display: flex;
      gap: 20px;
    }
    .controls button {
      width: 90px;
      height: 90px;
      font-size: 36px;
      border-radius: 50%;
      border: none;
      background: #444;
      color: white;
      box-shadow: 0px 4px 8px rgba(0,0,0,0.5);
      transition: transform 0.1s, background 0.2s;
    }
    .controls button:active {
      background: #888;
      transform: scale(0.9);
    }
    #ranking {
      margin-top: 20px;
      padding: 10px;
      border: 2px solid yellow;
      display: inline-block;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <h1>‚ö° Escape del Laberinto - 20 Niveles</h1>
  <h2 id="nivel">Nivel: 1</h2>
  <h3 id="vidas">Vidas: 3</h3>
  <canvas id="gameCanvas" width="900" height="600"></canvas>

  <div class="controls">
    <div><button id="btnUp">‚¨ÜÔ∏è</button></div>
    <div class="controls-row">
      <button id="btnLeft">‚¨ÖÔ∏è</button>
      <button id="btnDown">‚¨áÔ∏è</button>
      <button id="btnRight">‚û°Ô∏è</button>
    </div>
  </div>

  <div id="ranking">
    <h3>üèÜ Ranking de Tiempos</h3>
    <p id="tiempoActual">Tiempo actual: 0s</p>
    <p id="mejorTiempo">Mejor tiempo: -</p>
  </div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const player = { x: 20, y: 20, size: 25, color: "cyan", speed: 4 };
    const goal = { x: 850, y: 550, size: 35, color: "red" };

    let level = 1;
    let lives = 3;
    let keys = { ArrowUp: false, ArrowDown: false, ArrowLeft: false, ArrowRight: false };
    let walls = [];
    let enemies = [];
    let base = { x: 10, y: 10, w: 100, h: 100, color: "green" };

    // üïí tiempo
    let startTime = Date.now();
    let tiempoActual = 0;
    let mejorTiempo = localStorage.getItem("mejorTiempo") || null;

    function actualizarTiempo() {
      tiempoActual = Math.floor((Date.now() - startTime) / 1000);
      document.getElementById("tiempoActual").textContent = "Tiempo actual: " + tiempoActual + "s";
      if (mejorTiempo) {
        document.getElementById("mejorTiempo").textContent = "Mejor tiempo: " + mejorTiempo + "s";
      }
    }
    setInterval(actualizarTiempo, 1000);

    // üì¶ Generador de niveles
    const levels = [];
    for (let i = 1; i <= 20; i++) {
      let walls = [];
      let enemies = [];

      // paredes simples, aumentan dificultad
      for (let j = 0; j < i + 2; j++) {
        walls.push({
          x: 150 + Math.random() * 700 | 0,
          y: 100 + Math.random() * 400 | 0,
          w: 40,
          h: 100
        });
      }

      // enemigos
      for (let k = 0; k < i; k++) {
        enemies.push({
          x: 200 + Math.random() * 600 | 0,
          y: 150 + Math.random() * 350 | 0,
          w: 25,
          h: 25,
          dx: (Math.random() < 0.5 ? 1 : -1) * (2 + i/5),
          dy: (Math.random() < 0.5 ? 1 : -1) * (2 + i/5)
        });
      }

      levels.push({ walls, enemies });
    }

    function loadLevel(lv) {
      document.getElementById("nivel").textContent = "Nivel: " + lv;
      document.getElementById("vidas").textContent = "Vidas: " + lives;
      walls = levels[lv-1].walls;
      enemies = levels[lv-1].enemies.map(e => ({...e}));
      player.x = base.x + 20;
      player.y = base.y + 20;
    }

    function drawRect(obj, color) {
      ctx.fillStyle = color;
      ctx.fillRect(obj.x, obj.y, obj.w || obj.size, obj.h || obj.size);
    }

    function checkCollision(a, b) {
      return a.x < b.x + (b.w || b.size) &&
             a.x + (a.w || a.size) > b.x &&
             a.y < b.y + (b.h || b.size) &&
             a.y + (a.h || a.size) > b.y;
    }

    function resetKeys() {
      for (let k in keys) keys[k] = false;
    }

    function resetGame() {
      level = 1;
      lives = 3;
      resetKeys();
      loadLevel(level);
      startTime = Date.now();
    }

    function update() {
      if (keys.ArrowUp) player.y -= player.speed;
      if (keys.ArrowDown) player.y += player.speed;
      if (keys.ArrowLeft) player.x -= player.speed;
      if (keys.ArrowRight) player.x += player.speed;

      // üîí Limite canvas
      if (player.x < 0) player.x = 0;
      if (player.y < 0) player.y = 0;
      if (player.x + player.size > canvas.width) player.x = canvas.width - player.size;
      if (player.y + player.size > canvas.height) player.y = canvas.height - player.size;

      // Colisiones paredes
      for (let w of walls) {
        if (checkCollision(player, w)) {
          if (keys.ArrowUp) player.y += player.speed;
          if (keys.ArrowDown) player.y -= player.speed;
          if (keys.ArrowLeft) player.x += player.speed;
          if (keys.ArrowRight) player.x -= player.speed;
        }
      }

      // Movimiento enemigos
      for (let e of enemies) {
        e.x += e.dx;
        e.y += e.dy;
        if (e.x <= 0 || e.x + e.w >= canvas.width) e.dx *= -1;
        if (e.y <= 0 || e.y + e.h >= canvas.height) e.dy *= -1;
        if (checkCollision(player, e)) {
          lives--;
          if (lives > 0) {
            alert("üíÄ Moriste! Te quedan " + lives + " vidas.");
            resetKeys();
            loadLevel(level);
          } else {
            alert("üíÄ Te quedaste sin vidas. Reiniciando...");
            resetGame();
          }
          return;
        }
      }

      if (checkCollision(player, goal)) {
        if (level < levels.length) {
          level++;
          loadLevel(level);
        } else {
          let tiempoTotal = Math.floor((Date.now() - startTime) / 1000);
          alert("üéâ ¬°Ganaste todos los niveles! Tiempo total: " + tiempoTotal + "s");
          if (!mejorTiempo || tiempoTotal < mejorTiempo) {
            mejorTiempo = tiempoTotal;
            localStorage.setItem("mejorTiempo", mejorTiempo);
          }
          resetGame();
        }
      }
    }

    function draw() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      drawRect(base, base.color);
      drawRect(goal, goal.color);
      drawRect(player, player.color);
      for (let w of walls) drawRect(w, "gray");
      for (let e of enemies) drawRect(e, "yellow");
    }

    function gameLoop() {
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    document.addEventListener("keydown", e => { if (keys.hasOwnProperty(e.key)) keys[e.key] = true; });
    document.addEventListener("keyup", e => { if (keys.hasOwnProperty(e.key)) keys[e.key] = false; });

    function addControl(id, key) {
      const btn = document.getElementById(id);
      // Soporte m√≥vil (t√°ctil)
      btn.addEventListener("touchstart", e => { e.preventDefault(); keys[key] = true; });
      btn.addEventListener("touchend", e => { e.preventDefault(); keys[key] = false; });
      // Soporte PC (click con rat√≥n)
      btn.addEventListener("mousedown", e => { e.preventDefault(); keys[key] = true; });
      btn.addEventListener("mouseup", e => { e.preventDefault(); keys[key] = false; });
      btn.addEventListener("mouseleave", e => { e.preventDefault(); keys[key] = false; });
    }
    addControl("btnUp","ArrowUp");
    addControl("btnDown","ArrowDown");
    addControl("btnLeft","ArrowLeft");
    addControl("btnRight","ArrowRight");

    loadLevel(level);
    gameLoop();
  </script>
</body>
</html>



